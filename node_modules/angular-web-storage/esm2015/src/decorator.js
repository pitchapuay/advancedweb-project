import { StorageUtil, isBrowser } from './util';
const cache = {};
function WebStorage(storage, key, expiredAt = 0, expiredUnit = 'd') {
    return (target, propertyName) => {
        key = key || propertyName;
        Object.defineProperty(target, propertyName, {
            get: () => {
                return StorageUtil.get(storage, key);
            },
            set: (value) => {
                if (!cache[key]) {
                    const storedValue = StorageUtil.get(storage, key);
                    if (storedValue === null) {
                        StorageUtil.set(storage, key, value, expiredAt, expiredUnit);
                    }
                    cache[key] = true;
                    return;
                }
                StorageUtil.set(storage, key, value, expiredAt, expiredUnit);
            },
            enumerable: true,
            configurable: true,
        });
    };
}
/**
 * `localStorage` Decorator
 *
 * @param [expiredAt=0] Expiration time, 0 means forever
 * @param [expiredUnit='t'] Expiration time unit (default: custom [unit: ms])
 */
export function LocalStorage(key, expiredAt = 0, expiredUnit = 't') {
    return WebStorage(isBrowser ? localStorage : null, key, expiredAt, expiredUnit);
}
/**
 * `sessionStorage` Decorator
 *
 * @param [expiredAt=0] Expiration time, 0 means forever
 * @param [expiredUnit='t'] Expiration time unit (default: custom [unit: ms])
 */
export function SessionStorage(key, expiredAt = 0, expiredUnit = 't') {
    return WebStorage(isBrowser ? sessionStorage : null, key, expiredAt, expiredUnit);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdG9yLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci13ZWItc3RvcmFnZS8iLCJzb3VyY2VzIjpbInNyYy9kZWNvcmF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFlLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFLN0QsTUFBTSxLQUFLLEdBQVcsRUFBRSxDQUFDO0FBRXpCLFNBQVMsVUFBVSxDQUNqQixPQUFnQixFQUNoQixHQUFXLEVBQ1gsWUFBb0IsQ0FBQyxFQUNyQixjQUEyQixHQUFHO0lBRTlCLE9BQU8sQ0FBQyxNQUFjLEVBQUUsWUFBb0IsRUFBUSxFQUFFO1FBQ3BELEdBQUcsR0FBRyxHQUFHLElBQUksWUFBWSxDQUFDO1FBQzFCLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLFlBQVksRUFBRTtZQUMxQyxHQUFHLEVBQUUsR0FBRyxFQUFFO2dCQUNSLE9BQU8sV0FBVyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQVUsR0FBRyxDQUFDLENBQUM7WUFDL0MsQ0FBQztZQUNELEdBQUcsRUFBRSxDQUFDLEtBQVUsRUFBRSxFQUFFO2dCQUNsQixJQUFJLENBQUMsS0FBSyxDQUFTLEdBQUcsQ0FBQyxFQUFFO29CQUN2QixNQUFNLFdBQVcsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBVSxHQUFHLENBQUMsQ0FBQztvQkFDMUQsSUFBSSxXQUFXLEtBQUssSUFBSSxFQUFFO3dCQUN4QixXQUFXLENBQUMsR0FBRyxDQUNiLE9BQU8sRUFDQyxHQUFHLEVBQ1gsS0FBSyxFQUNMLFNBQVMsRUFDVCxXQUFXLENBQ1osQ0FBQztxQkFDSDtvQkFDRCxLQUFLLENBQVMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDO29CQUMxQixPQUFPO2lCQUNSO2dCQUNELFdBQVcsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFVLEdBQUcsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQ3ZFLENBQUM7WUFDRCxVQUFVLEVBQUUsSUFBSTtZQUNoQixZQUFZLEVBQUUsSUFBSTtTQUNuQixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUM7QUFDSixDQUFDO0FBRUQ7Ozs7O0dBS0c7QUFDSCxNQUFNLFVBQVUsWUFBWSxDQUMxQixHQUFZLEVBQ1osWUFBb0IsQ0FBQyxFQUNyQixjQUEyQixHQUFHO0lBRTlCLE9BQU8sVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQztBQUNsRixDQUFDO0FBRUQ7Ozs7O0dBS0c7QUFDSCxNQUFNLFVBQVUsY0FBYyxDQUM1QixHQUFZLEVBQ1osWUFBb0IsQ0FBQyxFQUNyQixjQUEyQixHQUFHO0lBRTlCLE9BQU8sVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQztBQUNwRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXhwaXJlZFVuaXQsIFN0b3JhZ2VVdGlsLCBpc0Jyb3dzZXIgfSBmcm9tICcuL3V0aWwnO1xyXG5cclxuaW50ZXJmYWNlIElDYWNoZSB7XHJcbiAgW2tleTogc3RyaW5nXTogYm9vbGVhbjtcclxufVxyXG5jb25zdCBjYWNoZTogSUNhY2hlID0ge307XHJcblxyXG5mdW5jdGlvbiBXZWJTdG9yYWdlKFxyXG4gIHN0b3JhZ2U6IFN0b3JhZ2UsXHJcbiAga2V5OiBzdHJpbmcsXHJcbiAgZXhwaXJlZEF0OiBudW1iZXIgPSAwLFxyXG4gIGV4cGlyZWRVbml0OiBFeHBpcmVkVW5pdCA9ICdkJyxcclxuKSB7XHJcbiAgcmV0dXJuICh0YXJnZXQ6IE9iamVjdCwgcHJvcGVydHlOYW1lOiBzdHJpbmcpOiB2b2lkID0+IHtcclxuICAgIGtleSA9IGtleSB8fCBwcm9wZXJ0eU5hbWU7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBwcm9wZXJ0eU5hbWUsIHtcclxuICAgICAgZ2V0OiAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIFN0b3JhZ2VVdGlsLmdldChzdG9yYWdlLCA8c3RyaW5nPmtleSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIHNldDogKHZhbHVlOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAoIWNhY2hlWzxzdHJpbmc+a2V5XSkge1xyXG4gICAgICAgICAgY29uc3Qgc3RvcmVkVmFsdWUgPSBTdG9yYWdlVXRpbC5nZXQoc3RvcmFnZSwgPHN0cmluZz5rZXkpO1xyXG4gICAgICAgICAgaWYgKHN0b3JlZFZhbHVlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIFN0b3JhZ2VVdGlsLnNldChcclxuICAgICAgICAgICAgICBzdG9yYWdlLFxyXG4gICAgICAgICAgICAgIDxzdHJpbmc+a2V5LFxyXG4gICAgICAgICAgICAgIHZhbHVlLFxyXG4gICAgICAgICAgICAgIGV4cGlyZWRBdCxcclxuICAgICAgICAgICAgICBleHBpcmVkVW5pdCxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNhY2hlWzxzdHJpbmc+a2V5XSA9IHRydWU7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFN0b3JhZ2VVdGlsLnNldChzdG9yYWdlLCA8c3RyaW5nPmtleSwgdmFsdWUsIGV4cGlyZWRBdCwgZXhwaXJlZFVuaXQpO1xyXG4gICAgICB9LFxyXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXHJcbiAgICB9KTtcclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogYGxvY2FsU3RvcmFnZWAgRGVjb3JhdG9yXHJcbiAqXHJcbiAqIEBwYXJhbSBbZXhwaXJlZEF0PTBdIEV4cGlyYXRpb24gdGltZSwgMCBtZWFucyBmb3JldmVyXHJcbiAqIEBwYXJhbSBbZXhwaXJlZFVuaXQ9J3QnXSBFeHBpcmF0aW9uIHRpbWUgdW5pdCAoZGVmYXVsdDogY3VzdG9tIFt1bml0OiBtc10pXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gTG9jYWxTdG9yYWdlKFxyXG4gIGtleT86IHN0cmluZyxcclxuICBleHBpcmVkQXQ6IG51bWJlciA9IDAsXHJcbiAgZXhwaXJlZFVuaXQ6IEV4cGlyZWRVbml0ID0gJ3QnLFxyXG4pIHtcclxuICByZXR1cm4gV2ViU3RvcmFnZShpc0Jyb3dzZXIgPyBsb2NhbFN0b3JhZ2UgOiBudWxsLCBrZXksIGV4cGlyZWRBdCwgZXhwaXJlZFVuaXQpO1xyXG59XHJcblxyXG4vKipcclxuICogYHNlc3Npb25TdG9yYWdlYCBEZWNvcmF0b3JcclxuICpcclxuICogQHBhcmFtIFtleHBpcmVkQXQ9MF0gRXhwaXJhdGlvbiB0aW1lLCAwIG1lYW5zIGZvcmV2ZXJcclxuICogQHBhcmFtIFtleHBpcmVkVW5pdD0ndCddIEV4cGlyYXRpb24gdGltZSB1bml0IChkZWZhdWx0OiBjdXN0b20gW3VuaXQ6IG1zXSlcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBTZXNzaW9uU3RvcmFnZShcclxuICBrZXk/OiBzdHJpbmcsXHJcbiAgZXhwaXJlZEF0OiBudW1iZXIgPSAwLFxyXG4gIGV4cGlyZWRVbml0OiBFeHBpcmVkVW5pdCA9ICd0JyxcclxuKSB7XHJcbiAgcmV0dXJuIFdlYlN0b3JhZ2UoaXNCcm93c2VyID8gc2Vzc2lvblN0b3JhZ2UgOiBudWxsLCBrZXksIGV4cGlyZWRBdCwgZXhwaXJlZFVuaXQpO1xyXG59XHJcbiJdfQ==