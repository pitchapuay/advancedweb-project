/**
 * 判断是否在浏览器中渲染Angular应用
 * `decorator` 无法直接使用Angular `PLATFORM_ID` 标识
 * 这带来的好处是当服务端自行填充 Document 时也能很好的识别
 */
export const isBrowser = typeof document === 'object' && !!document;
export class StorageUtil {
    static get(storage, key) {
        if (storage == null) {
            return null;
        }
        const value = StorageUtil.parse(storage.getItem(key) || 'null') || null;
        if (value === null)
            return null;
        if (typeof value === 'object' &&
            typeof value._expired !== 'undefined' &&
            value._expired !== 0 &&
            +new Date() > value._expired) {
            StorageUtil.remove(storage, key);
            return null;
        }
        return value._value || null;
    }
    static set(storage, key, value, expiredAt = 0, expiredUnit = 't') {
        if (storage == null) {
            return;
        }
        storage.setItem(key, StorageUtil.stringify({
            _expired: StorageUtil.getExpired(expiredAt, expiredUnit),
            _value: value,
        }));
    }
    static remove(storage, key) {
        if (storage == null) {
            return;
        }
        storage.removeItem(key);
    }
    static key(storage, index) {
        if (storage == null) {
            return;
        }
        return storage.key(index);
    }
    static getExpired(val, unit) {
        if (val <= 0)
            return 0;
        const now = +new Date();
        switch (unit) {
            case 's': // 秒
                return now + 1000 * val;
            case 'm': // 分
                return now + 1000 * 60 * val;
            case 'h': // 时
                return now + 1000 * 60 * 60 * val;
            case 'd': // 天
                return now + 1000 * 60 * 60 * 24 * val;
            case 'w': // 周
                return now + 1000 * 60 * 60 * 24 * 7 * val;
            case 'y': // 年
                return now + 1000 * 60 * 60 * 24 * 365 * val;
            case 't': // 自定义
                return now + val;
        }
        return 0;
    }
    static stringify(value) {
        return JSON.stringify(value);
    }
    static parse(text) {
        try {
            return JSON.parse(text) || null;
        }
        catch (e) {
            return text;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItd2ViLXN0b3JhZ2UvIiwic291cmNlcyI6WyJzcmMvdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFZQTs7OztHQUlHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sU0FBUyxHQUFHLE9BQU8sUUFBUSxLQUFLLFFBQVEsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDO0FBRXBFLE1BQU0sT0FBTyxXQUFXO0lBQ3RCLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBdUIsRUFBRSxHQUFXO1FBQzdDLElBQUksT0FBTyxJQUFJLElBQUksRUFBRTtZQUNuQixPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQztRQUN4RSxJQUFJLEtBQUssS0FBSyxJQUFJO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFDaEMsSUFDRSxPQUFPLEtBQUssS0FBSyxRQUFRO1lBQ3pCLE9BQU8sS0FBSyxDQUFDLFFBQVEsS0FBSyxXQUFXO1lBQ3JDLEtBQUssQ0FBQyxRQUFRLEtBQUssQ0FBQztZQUNwQixDQUFDLElBQUksSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFDNUI7WUFDQSxXQUFXLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNqQyxPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsT0FBTyxLQUFLLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQztJQUM5QixDQUFDO0lBRUQsTUFBTSxDQUFDLEdBQUcsQ0FDUixPQUF1QixFQUN2QixHQUFXLEVBQ1gsS0FBVSxFQUNWLFlBQW9CLENBQUMsRUFDckIsY0FBMkIsR0FBRztRQUU5QixJQUFJLE9BQU8sSUFBSSxJQUFJLEVBQUU7WUFDbkIsT0FBUTtTQUNUO1FBQ0QsT0FBTyxDQUFDLE9BQU8sQ0FDYixHQUFHLEVBQ0gsV0FBVyxDQUFDLFNBQVMsQ0FBQztZQUNwQixRQUFRLEVBQUUsV0FBVyxDQUFDLFVBQVUsQ0FBQyxTQUFTLEVBQUUsV0FBVyxDQUFDO1lBQ3hELE1BQU0sRUFBRSxLQUFLO1NBQ2QsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUF1QixFQUFFLEdBQVc7UUFDaEQsSUFBSSxPQUFPLElBQUksSUFBSSxFQUFFO1lBQ25CLE9BQVE7U0FDVDtRQUNELE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQUVELE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBdUIsRUFBRSxLQUFhO1FBQy9DLElBQUksT0FBTyxJQUFJLElBQUksRUFBRTtZQUNuQixPQUFRO1NBQ1Q7UUFDRCxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUVPLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBVyxFQUFFLElBQWlCO1FBQ3RELElBQUksR0FBRyxJQUFJLENBQUM7WUFBRSxPQUFPLENBQUMsQ0FBQztRQUN2QixNQUFNLEdBQUcsR0FBRyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUM7UUFDeEIsUUFBUSxJQUFJLEVBQUU7WUFDWixLQUFLLEdBQUcsRUFBRSxJQUFJO2dCQUNaLE9BQU8sR0FBRyxHQUFHLElBQUksR0FBRyxHQUFHLENBQUM7WUFDMUIsS0FBSyxHQUFHLEVBQUUsSUFBSTtnQkFDWixPQUFPLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQztZQUMvQixLQUFLLEdBQUcsRUFBRSxJQUFJO2dCQUNaLE9BQU8sR0FBRyxHQUFHLElBQUksR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQztZQUNwQyxLQUFLLEdBQUcsRUFBRSxJQUFJO2dCQUNaLE9BQU8sR0FBRyxHQUFHLElBQUksR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUM7WUFDekMsS0FBSyxHQUFHLEVBQUUsSUFBSTtnQkFDWixPQUFPLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUM3QyxLQUFLLEdBQUcsRUFBRSxJQUFJO2dCQUNaLE9BQU8sR0FBRyxHQUFHLElBQUksR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDO1lBQy9DLEtBQUssR0FBRyxFQUFFLE1BQU07Z0JBQ2QsT0FBTyxHQUFHLEdBQUcsR0FBRyxDQUFDO1NBQ3BCO1FBQ0QsT0FBTyxDQUFDLENBQUM7SUFDWCxDQUFDO0lBRU8sTUFBTSxDQUFDLFNBQVMsQ0FBQyxLQUFVO1FBQ2pDLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMvQixDQUFDO0lBRU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFZO1FBQy9CLElBQUk7WUFDRixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDO1NBQ2pDO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDVixPQUFPLElBQUksQ0FBQztTQUNiO0lBQ0gsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEV4cGlyYXRpb24gdGltZSB1bml0XHJcbiAqIHM6IHNlY29uZHNcclxuICogbTogbWludXRlXHJcbiAqIGg6IGhvdXJcclxuICogZDogZGF5XHJcbiAqIHc6IHdlZWtcclxuICogeTogeWVhclxyXG4gKiB0OiBDdXN0b20gKG1pbGxpc2Vjb25kKVxyXG4gKi9cclxuZXhwb3J0IHR5cGUgRXhwaXJlZFVuaXQgPSAncycgfCAnbScgfCAnaCcgfCAnZCcgfCAndycgfCAneScgfCAndCc7XHJcblxyXG4vKipcclxuICog5Yik5pat5piv5ZCm5Zyo5rWP6KeI5Zmo5Lit5riy5p+TQW5ndWxhcuW6lOeUqFxyXG4gKiBgZGVjb3JhdG9yYCDml6Dms5Xnm7TmjqXkvb/nlKhBbmd1bGFyIGBQTEFURk9STV9JRGAg5qCH6K+GXHJcbiAqIOi/meW4puadpeeahOWlveWkhOaYr+W9k+acjeWKoeerr+iHquihjOWhq+WFhSBEb2N1bWVudCDml7bkuZ/og73lvojlpb3nmoTor4bliKtcclxuICovXHJcbmV4cG9ydCBjb25zdCBpc0Jyb3dzZXIgPSB0eXBlb2YgZG9jdW1lbnQgPT09ICdvYmplY3QnICYmICEhZG9jdW1lbnQ7XHJcblxyXG5leHBvcnQgY2xhc3MgU3RvcmFnZVV0aWwge1xyXG4gIHN0YXRpYyBnZXQoc3RvcmFnZTogU3RvcmFnZSB8IG51bGwsIGtleTogc3RyaW5nKSB7XHJcbiAgICBpZiAoc3RvcmFnZSA9PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgY29uc3QgdmFsdWUgPSBTdG9yYWdlVXRpbC5wYXJzZShzdG9yYWdlLmdldEl0ZW0oa2V5KSB8fCAnbnVsbCcpIHx8IG51bGw7XHJcbiAgICBpZiAodmFsdWUgPT09IG51bGwpIHJldHVybiBudWxsO1xyXG4gICAgaWYgKFxyXG4gICAgICB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmXHJcbiAgICAgIHR5cGVvZiB2YWx1ZS5fZXhwaXJlZCAhPT0gJ3VuZGVmaW5lZCcgJiZcclxuICAgICAgdmFsdWUuX2V4cGlyZWQgIT09IDAgJiZcclxuICAgICAgK25ldyBEYXRlKCkgPiB2YWx1ZS5fZXhwaXJlZFxyXG4gICAgKSB7XHJcbiAgICAgIFN0b3JhZ2VVdGlsLnJlbW92ZShzdG9yYWdlLCBrZXkpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdmFsdWUuX3ZhbHVlIHx8IG51bGw7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgc2V0KFxyXG4gICAgc3RvcmFnZTogU3RvcmFnZSB8IG51bGwsXHJcbiAgICBrZXk6IHN0cmluZyxcclxuICAgIHZhbHVlOiBhbnksXHJcbiAgICBleHBpcmVkQXQ6IG51bWJlciA9IDAsXHJcbiAgICBleHBpcmVkVW5pdDogRXhwaXJlZFVuaXQgPSAndCcsXHJcbiAgKSB7XHJcbiAgICBpZiAoc3RvcmFnZSA9PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiA7XHJcbiAgICB9XHJcbiAgICBzdG9yYWdlLnNldEl0ZW0oXHJcbiAgICAgIGtleSxcclxuICAgICAgU3RvcmFnZVV0aWwuc3RyaW5naWZ5KHtcclxuICAgICAgICBfZXhwaXJlZDogU3RvcmFnZVV0aWwuZ2V0RXhwaXJlZChleHBpcmVkQXQsIGV4cGlyZWRVbml0KSxcclxuICAgICAgICBfdmFsdWU6IHZhbHVlLFxyXG4gICAgICB9KSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgcmVtb3ZlKHN0b3JhZ2U6IFN0b3JhZ2UgfCBudWxsLCBrZXk6IHN0cmluZykge1xyXG4gICAgaWYgKHN0b3JhZ2UgPT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gO1xyXG4gICAgfVxyXG4gICAgc3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMga2V5KHN0b3JhZ2U6IFN0b3JhZ2UgfCBudWxsLCBpbmRleDogbnVtYmVyKSB7XHJcbiAgICBpZiAoc3RvcmFnZSA9PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiA7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gc3RvcmFnZS5rZXkoaW5kZXgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0RXhwaXJlZCh2YWw6IG51bWJlciwgdW5pdDogRXhwaXJlZFVuaXQpOiBudW1iZXIge1xyXG4gICAgaWYgKHZhbCA8PSAwKSByZXR1cm4gMDtcclxuICAgIGNvbnN0IG5vdyA9ICtuZXcgRGF0ZSgpO1xyXG4gICAgc3dpdGNoICh1bml0KSB7XHJcbiAgICAgIGNhc2UgJ3MnOiAvLyDnp5JcclxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIHZhbDtcclxuICAgICAgY2FzZSAnbSc6IC8vIOWIhlxyXG4gICAgICAgIHJldHVybiBub3cgKyAxMDAwICogNjAgKiB2YWw7XHJcbiAgICAgIGNhc2UgJ2gnOiAvLyDml7ZcclxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIDYwICogNjAgKiB2YWw7XHJcbiAgICAgIGNhc2UgJ2QnOiAvLyDlpKlcclxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIDYwICogNjAgKiAyNCAqIHZhbDtcclxuICAgICAgY2FzZSAndyc6IC8vIOWRqFxyXG4gICAgICAgIHJldHVybiBub3cgKyAxMDAwICogNjAgKiA2MCAqIDI0ICogNyAqIHZhbDtcclxuICAgICAgY2FzZSAneSc6IC8vIOW5tFxyXG4gICAgICAgIHJldHVybiBub3cgKyAxMDAwICogNjAgKiA2MCAqIDI0ICogMzY1ICogdmFsO1xyXG4gICAgICBjYXNlICd0JzogLy8g6Ieq5a6a5LmJXHJcbiAgICAgICAgcmV0dXJuIG5vdyArIHZhbDtcclxuICAgIH1cclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzdGF0aWMgc3RyaW5naWZ5KHZhbHVlOiBhbnkpIHtcclxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyBwYXJzZSh0ZXh0OiBzdHJpbmcpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKHRleHQpIHx8IG51bGw7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIHJldHVybiB0ZXh0O1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=